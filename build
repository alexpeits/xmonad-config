#!/usr/bin/env nix-shell
#!nix-shell ./lib/default.nix -i bash

base="$HOME/.xmonad"
extra_flags_filename="extra-ghc-flags"

hostname="$(hostname)"
host_dir="$base/hosts/$hostname"
extra_flags_file="$host_dir/$extra_flags_filename"

if [ -f "$extra_flags_file" ]; then
    extra_flags="$(cat "$extra_flags_file" | tr '\n' ' ')"
    echo "Recompiling xmonad with flags: $extra_flags"
else
    extra_flags=""
    echo "Recompiling xmonad (no flags)"
fi

ghc --make xmonad.hs -i. -ilib -fforce-recomp -main-is main -v0 -o "$1" $extra_flags
